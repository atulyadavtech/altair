##OS preapration 

#Step 1 :User Creation 
useradd -mr pbsdata
echo "password"  | passwd --stdin pbsdata
useradd pbsadmin
echo "password"  | passwd --stdin pbsadmin


chmod +x /etc/rc.d/rc.local

#Selinux disable
sed -i 's/=enforcing/=disabled/' /etc/selinux/config

#Directory Structure
mkdir -p /scratch /home/stage
mkdir -p /altair/media/rhel8.2/media1/
mkdir -p /altair/media/rhel8.2/media2/
mkdir -p /altair/hw
chmod 1777 -R  /scratch

# YUM Repo
cat >/etc/yum.repos.d/altair.repo << EOF
[BaseOS]
name=rhel8.2-media1-BOS
baseurl=file:///altair/media/rhel8.2/media1/BaseOS
enabled=1
gpgcheck=0

[AppStream]
name=rhel8.2-media1-AS
baseurl=file:///altair/media/rhel8.2/media1/AppStream
enabled=1
gpgcheck=0

[Supplementary]
name=rhel8.2-media2-supplementary
baseurl=file:///altair/media/rhel8.2/media2
enabled=0
gpgcheck=0
EOF





##Config File 
wget https://raw.githubusercontent.com/atulyadavtech/Conf-Files/master/limits.conf -O /etc/security/limits.conf
wget https://raw.githubusercontent.com/atulyadavtech/Conf-Files/master/history-sh -O /etc/profile.d/altair.sh
wget https://raw.githubusercontent.com/atulyadavtech/help/master/ssh.sh -O /etc/profile.d/ssh.sh
wget https://raw.githubusercontent.com/atulyadavtech/help/master/ssh.csh -O /etc/profile.d/ssh.csh
wget https://raw.githubusercontent.com/atulyadavtech/Conf-Files/master/master-80-systcl.conf -O /etc/sysctl.d/90-master-sysctl.conf
#wget https://raw.githubusercontent.com/atulyadavtech/Conf-Files/master/rhel8.repo -O /etc/yum.repos.d/altair.repo


#SSH Fine tunning 
wget  https://raw.githubusercontent.com/atulyadavtech/Conf-Files/master/ssh_config  -O ->> /etc/ssh/ssh_config
echo "X11UseLocalhost no" >> /etc/ssh/sshd_config
echo "AddressFamily inet" >> /etc/ssh/sshd_config
echo "UseDNS no" >> /etc/ssh/sshd_config


#Remove initial screen 
sed -i '/daemon/a InitialSetupEnable=False' /etc/gdm/custom.conf

#Remove the ssh login msg
rm -rfv /etc/motd.d/*


#Python linking 
ln -s /usr/bin/python3 /usr/bin/python


#Package
yum install -y xauth xterm network-scripts mlocate ipmitool nmap yum-plugin-changelog 


#Services
systemctl disable rhsmcertd.service ModemManager.service cups bluetooth firewalld NetworkManager


#Firewall
systemctl mask firewalld;systemctl stop firewalld;yum -y install iptables-services;systemctl enable iptables;systemctl start iptables
sync
iptables --list;iptables --flush;iptables --delete-chain;service iptables save


## Disable Virtual Interface  (optional)
virsh net-undefine default;chkconfig libvirtd off;systemctl disable libvirtd.service


#TimeZone Setup
timedatectl set-timezone Asia/Kolkata
timedatectl set-ntp yes


#Hostname verification  
hostnamectl status
hostname -A;hostname -d;hostname -f;hostname -i;hostname -I


#Network naming convention
wget -O - https://raw.githubusercontent.com/atulyadavtech/lipi/main/ethx | bash 
mkdir /root/test; mv /etc/sysconfig/network-scripts/ifcfg-e* /root/test/
wget https://raw.githubusercontent.com/atulyadavtech/Conf-Files/master/ifcfg-eth0  -O /etc/sysconfig/network-scripts/ifcfg-eth0
wget https://raw.githubusercontent.com/atulyadavtech/Conf-Files/master/ifcfg-eth1  -O /etc/sysconfig/network-scripts/ifcfg-eth1
systemctl enable network
touch /etc/sysconfig/disable-deprecation-warnings
